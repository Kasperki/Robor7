                        .module motorcontrol.c
                        .area text(rom, con, rel)
 0000                   .dbfile ./motorcontrol.c
                        .area lit(rom, con, rel, lit)
 0000           _OIKEUSKERROIN::
 0000 3F800000          .word 0x3f80,0x0
 0004                   .dbfile Z:\Robo\Robor7\ROBOTT~1\ROBOTT~1\motorcontrol.c
 0004                   .dbsym e OIKEUSKERROIN _OIKEUSKERROIN kD
                        .area text(rom, con, rel)
 0000                   .dbfile Z:\Robo\Robor7\ROBOTT~1\ROBOTT~1\motorcontrol.c
 0000                   .dbfunc e InitPWM _InitPWM fV
 0000           _InitPWM::
 0000                   .dbline -1
 0000                   .dbline 20
 0000           ; #include <m8c.h>        // part specific constants and macros
 0000           ; #include "PSoCAPI.h"    // PSoC API definitions for all User Modules
 0000           ; 
 0000           ; #define BACKWARD      0b00000101; // Molemmat Eteen
 0000           ; #define FORWARD       0b00001010; //Molemmat Taakse
 0000           ; #define LEFTBRIGHTF 0b00001001; // Vasen Eteen Oikea Taakse
 0000           ; #define LEFTFRIGHTB 0b00000110; // Vasen Taakse Oikea Eteen
 0000           ; #define NOLLAA                0b11110000;             //Molemmat C/D pinnit 0
 0000           ; 
 0000           ; //Porttien osoitteet
 0000           ; //Port1_0 LEFTC      C = 1, D = 0 FORWARD
 0000           ; //Port1_1 LEFTD                C = 0, D = 1 BACKWARD 
 0000           ; //Port1_2 RIGHTC
 0000           ; //Port1_3 RIGHTD
 0000           ; 
 0000           ; const float OIKEUSKERROIN = 1.0f; //Kerroin vasemalle puolelle jotta robotti kulkisi suoraan
 0000           ; 
 0000           ; //Käynnistää PWM Moduulit
 0000           ; void InitPWM()
 0000           ; {
 0000                   .dbline 21
 0000           ;       PWM8_VASEN_Start();
 0000 10                push X
 0001 7C0000            xcall _PWM8_VASEN_Start
 0004                   .dbline 22
 0004           ;       PWM8_OIKEA_Start();
 0004 7C0000            xcall _PWM8_OIKEA_Start
 0007 20                pop X
 0008                   .dbline -2
 0008           L1:
 0008                   .dbline 0 ; func end
 0008 7F                ret
 0009                   .dbend
 0009                   .dbfunc e MoveForward _MoveForward fV
 0009           ;          pulse -> X-5
 0009           _MoveForward::
 0009                   .dbline -1
 0009 10                push X
 000A 4F                mov X,SP
 000B 3802              add SP,2
 000D                   .dbline 30
 000D           ;       
 000D           ;       //Port1_Data_ADDR = LEFTC_Data_ADDR;
 000D           ;       //Port1_Data_ADDR &= NOLLAA;
 000D           ; }
 000D           ; 
 000D           ; //Kulkee eteenpäin arvolla..
 000D           ; void MoveForward(int pulse)
 000D           ; {                             
 000D                   .dbline 31
 000D           ;       LEFTC_Data_ADDR &= NOLLAA;
 000D 4104F0            and REG[0x4],-16
 0010                   .dbline 31
 0010                   .dbline 32
 0010           ;       LEFTC_Data_ADDR |= FORWARD;
 0010 43040A            or REG[0x4],10
 0013                   .dbline 32
 0013                   .dbline 34
 0013           ; 
 0013           ;       PWM8_VASEN_WritePulseWidth((BYTE)(pulse * OIKEUSKERROIN));
 0013 550000            mov [__r1],<_OIKEUSKERROIN
 0016 5000              mov A,>_OIKEUSKERROIN
 0018 10                push X
 0019 5800              mov X,[__r1]
 001B 08                push A
 001C 28                romx
 001D 5300              mov [__r0],A
 001F 18                pop A
 0020 75                inc X
 0021 0900              adc A,0
 0023 08                push A
 0024 28                romx
 0025 5300              mov [__r1],A
 0027 18                pop A
 0028 75                inc X
 0029 0900              adc A,0
 002B 08                push A
 002C 28                romx
 002D 5300              mov [__r2],A
 002F 18                pop A
 0030 75                inc X
 0031 0900              adc A,0
 0033 28                romx
 0034 5300              mov [__r3],A
 0036 20                pop X
 0037 52FC              mov A,[X-4]
 0039 5300              mov [__r7],A
 003B 52FB              mov A,[X-5]
 003D 5300              mov [__r6],A
 003F 470080            tst [__r6],-128
 0042 A009              jz X0
 0044 5500FF            mov [__r5],-1
 0047 5500FF            mov [__r4],-1
 004A 8007              jmp X1
 004C           X0:
 004C 550000            mov [__r5],0
 004F 550000            mov [__r4],0
 0052           X1:
 0052 5100              mov A,[__r4]
 0054 08                push A
 0055 5100              mov A,[__r5]
 0057 08                push A
 0058 5100              mov A,[__r6]
 005A 08                push A
 005B 5100              mov A,[__r7]
 005D 08                push A
 005E 7C0000            xcall __long2fp
 0061 18                pop A
 0062 5300              mov [__r7],A
 0064 18                pop A
 0065 5300              mov [__r6],A
 0067 18                pop A
 0068 5300              mov [__r5],A
 006A 18                pop A
 006B 5300              mov [__r4],A
 006D 5100              mov A,[__r0]
 006F 08                push A
 0070 5100              mov A,[__r1]
 0072 08                push A
 0073 5100              mov A,[__r2]
 0075 08                push A
 0076 5100              mov A,[__r3]
 0078 08                push A
 0079 5100              mov A,[__r4]
 007B 08                push A
 007C 5100              mov A,[__r5]
 007E 08                push A
 007F 5100              mov A,[__r6]
 0081 08                push A
 0082 5100              mov A,[__r7]
 0084 08                push A
 0085 7C0000            xcall __fpmul
 0088 18                pop A
 0089 5300              mov [__r3],A
 008B 18                pop A
 008C 5300              mov [__r2],A
 008E 18                pop A
 008F 5300              mov [__r1],A
 0091 18                pop A
 0092 5300              mov [__r0],A
 0094 38FC              add SP,-4
 0096 5047              mov A,71
 0098 08                push A
 0099 5000              mov A,0
 009B 08                push A
 009C 08                push A
 009D 08                push A
 009E 5100              mov A,[__r0]
 00A0 08                push A
 00A1 5100              mov A,[__r1]
 00A3 08                push A
 00A4 5100              mov A,[__r2]
 00A6 08                push A
 00A7 5100              mov A,[__r3]
 00A9 08                push A
 00AA 7C0000            xcall __fpcmp
 00AD 38F8              add SP,-8
 00AF 39FF              cmp A,-1
 00B1 A047              jz L4
 00B3 5047              mov A,71
 00B5 08                push A
 00B6 5000              mov A,0
 00B8 08                push A
 00B9 08                push A
 00BA 08                push A
 00BB 5100              mov A,[__r0]
 00BD 08                push A
 00BE 5100              mov A,[__r1]
 00C0 08                push A
 00C1 5100              mov A,[__r2]
 00C3 08                push A
 00C4 5100              mov A,[__r3]
 00C6 08                push A
 00C7 7C0000            xcall __fpsub
 00CA 18                pop A
 00CB 5300              mov [__r7],A
 00CD 18                pop A
 00CE 5300              mov [__r6],A
 00D0 18                pop A
 00D1 5300              mov [__r5],A
 00D3 18                pop A
 00D4 38FC              add SP,-4
 00D6 08                push A
 00D7 5100              mov A,[__r5]
 00D9 08                push A
 00DA 5100              mov A,[__r6]
 00DC 08                push A
 00DD 5100              mov A,[__r7]
 00DF 08                push A
 00E0 7C0000            xcall __fp2long
 00E3 18                pop A
 00E4 5300              mov [__r5],A
 00E6 18                pop A
 00E7 5300              mov [__r4],A
 00E9 38FE              add SP,-2
 00EB 5100              mov A,[__r5]
 00ED 0100              add A,0
 00EF 5401              mov [X+1],A
 00F1 5100              mov A,[__r4]
 00F3 0980              adc A,-128
 00F5 5400              mov [X+0],A
 00F7 8020              xjmp L5
 00F9           L4:
 00F9 5100              mov A,[__r0]
 00FB 08                push A
 00FC 5100              mov A,[__r1]
 00FE 08                push A
 00FF 5100              mov A,[__r2]
 0101 08                push A
 0102 5100              mov A,[__r3]
 0104 08                push A
 0105 7C0000            xcall __fp2long
 0108 18                pop A
 0109 5300              mov [__r1],A
 010B 18                pop A
 010C 5300              mov [__r0],A
 010E 38FE              add SP,-2
 0110 5100              mov A,[__r1]
 0112 5401              mov [X+1],A
 0114 5100              mov A,[__r0]
 0116 5400              mov [X+0],A
 0118           L5:
 0118 5201              mov A,[X+1]
 011A 10                push X
 011B 7C0000            xcall _PWM8_VASEN_WritePulseWidth
 011E 20                pop X
 011F                   .dbline 35
 011F           ;       PWM8_OIKEA_WritePulseWidth((BYTE)pulse);
 011F 52FC              mov A,[X-4]
 0121 10                push X
 0122 7C0000            xcall _PWM8_OIKEA_WritePulseWidth
 0125 20                pop X
 0126                   .dbline -2
 0126           L2:
 0126 38FE              add SP,-2
 0128 20                pop X
 0129                   .dbline 0 ; func end
 0129 7F                ret
 012A                   .dbsym l pulse -5 I
 012A                   .dbend
 012A                   .dbfunc e MoveBackward _MoveBackward fV
 012A           ;          pulse -> X-5
 012A           _MoveBackward::
 012A                   .dbline -1
 012A 10                push X
 012B 4F                mov X,SP
 012C 3802              add SP,2
 012E                   .dbline 40
 012E           ; }
 012E           ; 
 012E           ; //Kulkee taaksepäin arvolla
 012E           ; void MoveBackward(int pulse)
 012E           ; {
 012E                   .dbline 41
 012E           ;       LEFTC_Data_ADDR &= NOLLAA;
 012E 4104F0            and REG[0x4],-16
 0131                   .dbline 41
 0131                   .dbline 42
 0131           ;       LEFTC_Data_ADDR |= BACKWARD;
 0131 430405            or REG[0x4],5
 0134                   .dbline 42
 0134                   .dbline 44
 0134           ;       
 0134           ;       PWM8_VASEN_WritePulseWidth((BYTE)(pulse * OIKEUSKERROIN));
 0134 550000            mov [__r1],<_OIKEUSKERROIN
 0137 5000              mov A,>_OIKEUSKERROIN
 0139 10                push X
 013A 5800              mov X,[__r1]
 013C 08                push A
 013D 28                romx
 013E 5300              mov [__r0],A
 0140 18                pop A
 0141 75                inc X
 0142 0900              adc A,0
 0144 08                push A
 0145 28                romx
 0146 5300              mov [__r1],A
 0148 18                pop A
 0149 75                inc X
 014A 0900              adc A,0
 014C 08                push A
 014D 28                romx
 014E 5300              mov [__r2],A
 0150 18                pop A
 0151 75                inc X
 0152 0900              adc A,0
 0154 28                romx
 0155 5300              mov [__r3],A
 0157 20                pop X
 0158 52FC              mov A,[X-4]
 015A 5300              mov [__r7],A
 015C 52FB              mov A,[X-5]
 015E 5300              mov [__r6],A
 0160 470080            tst [__r6],-128
 0163 A009              jz X3
 0165 5500FF            mov [__r5],-1
 0168 5500FF            mov [__r4],-1
 016B 8007              jmp X4
 016D           X3:
 016D 550000            mov [__r5],0
 0170 550000            mov [__r4],0
 0173           X4:
 0173 5100              mov A,[__r4]
 0175 08                push A
 0176 5100              mov A,[__r5]
 0178 08                push A
 0179 5100              mov A,[__r6]
 017B 08                push A
 017C 5100              mov A,[__r7]
 017E 08                push A
 017F 7C0000            xcall __long2fp
 0182 18                pop A
 0183 5300              mov [__r7],A
 0185 18                pop A
 0186 5300              mov [__r6],A
 0188 18                pop A
 0189 5300              mov [__r5],A
 018B 18                pop A
 018C 5300              mov [__r4],A
 018E 5100              mov A,[__r0]
 0190 08                push A
 0191 5100              mov A,[__r1]
 0193 08                push A
 0194 5100              mov A,[__r2]
 0196 08                push A
 0197 5100              mov A,[__r3]
 0199 08                push A
 019A 5100              mov A,[__r4]
 019C 08                push A
 019D 5100              mov A,[__r5]
 019F 08                push A
 01A0 5100              mov A,[__r6]
 01A2 08                push A
 01A3 5100              mov A,[__r7]
 01A5 08                push A
 01A6 7C0000            xcall __fpmul
 01A9 18                pop A
 01AA 5300              mov [__r3],A
 01AC 18                pop A
 01AD 5300              mov [__r2],A
 01AF 18                pop A
 01B0 5300              mov [__r1],A
 01B2 18                pop A
 01B3 5300              mov [__r0],A
 01B5 38FC              add SP,-4
 01B7 5047              mov A,71
 01B9 08                push A
 01BA 5000              mov A,0
 01BC 08                push A
 01BD 08                push A
 01BE 08                push A
 01BF 5100              mov A,[__r0]
 01C1 08                push A
 01C2 5100              mov A,[__r1]
 01C4 08                push A
 01C5 5100              mov A,[__r2]
 01C7 08                push A
 01C8 5100              mov A,[__r3]
 01CA 08                push A
 01CB 7C0000            xcall __fpcmp
 01CE 38F8              add SP,-8
 01D0 39FF              cmp A,-1
 01D2 A047              jz L8
 01D4 5047              mov A,71
 01D6 08                push A
 01D7 5000              mov A,0
 01D9 08                push A
 01DA 08                push A
 01DB 08                push A
 01DC 5100              mov A,[__r0]
 01DE 08                push A
 01DF 5100              mov A,[__r1]
 01E1 08                push A
 01E2 5100              mov A,[__r2]
 01E4 08                push A
 01E5 5100              mov A,[__r3]
 01E7 08                push A
 01E8 7C0000            xcall __fpsub
 01EB 18                pop A
 01EC 5300              mov [__r7],A
 01EE 18                pop A
 01EF 5300              mov [__r6],A
 01F1 18                pop A
 01F2 5300              mov [__r5],A
 01F4 18                pop A
 01F5 38FC              add SP,-4
 01F7 08                push A
 01F8 5100              mov A,[__r5]
 01FA 08                push A
 01FB 5100              mov A,[__r6]
 01FD 08                push A
 01FE 5100              mov A,[__r7]
 0200 08                push A
 0201 7C0000            xcall __fp2long
 0204 18                pop A
 0205 5300              mov [__r5],A
 0207 18                pop A
 0208 5300              mov [__r4],A
 020A 38FE              add SP,-2
 020C 5100              mov A,[__r5]
 020E 0100              add A,0
 0210 5401              mov [X+1],A
 0212 5100              mov A,[__r4]
 0214 0980              adc A,-128
 0216 5400              mov [X+0],A
 0218 8020              xjmp L9
 021A           L8:
 021A 5100              mov A,[__r0]
 021C 08                push A
 021D 5100              mov A,[__r1]
 021F 08                push A
 0220 5100              mov A,[__r2]
 0222 08                push A
 0223 5100              mov A,[__r3]
 0225 08                push A
 0226 7C0000            xcall __fp2long
 0229 18                pop A
 022A 5300              mov [__r1],A
 022C 18                pop A
 022D 5300              mov [__r0],A
 022F 38FE              add SP,-2
 0231 5100              mov A,[__r1]
 0233 5401              mov [X+1],A
 0235 5100              mov A,[__r0]
 0237 5400              mov [X+0],A
 0239           L9:
 0239 5201              mov A,[X+1]
 023B 10                push X
 023C 7C0000            xcall _PWM8_VASEN_WritePulseWidth
 023F 20                pop X
 0240                   .dbline 45
 0240           ;       PWM8_OIKEA_WritePulseWidth((BYTE)pulse);
 0240 52FC              mov A,[X-4]
 0242 10                push X
 0243 7C0000            xcall _PWM8_OIKEA_WritePulseWidth
 0246 20                pop X
 0247                   .dbline -2
 0247           L6:
 0247 38FE              add SP,-2
 0249 20                pop X
 024A                   .dbline 0 ; func end
 024A 7F                ret
 024B                   .dbsym l pulse -5 I
 024B                   .dbend
 024B                   .dbfunc e Stop _Stop fV
 024B           _Stop::
 024B                   .dbline -1
 024B                   .dbline 50
 024B           ; }
 024B           ; 
 024B           ; //Pysäyttää Moottorit
 024B           ; void Stop()
 024B           ; {
 024B                   .dbline 51
 024B           ;       PWM8_OIKEA_WritePulseWidth(0);
 024B 10                push X
 024C 5000              mov A,0
 024E 7C0000            xcall _PWM8_OIKEA_WritePulseWidth
 0251                   .dbline 52
 0251           ;       PWM8_VASEN_WritePulseWidth(0);
 0251 5000              mov A,0
 0253 7C0000            xcall _PWM8_VASEN_WritePulseWidth
 0256 20                pop X
 0257                   .dbline 54
 0257           ;       
 0257           ;       LEFTC_Data_ADDR &= NOLLAA;
 0257 4104F0            and REG[0x4],-16
 025A                   .dbline 54
 025A                   .dbline -2
 025A           L10:
 025A                   .dbline 0 ; func end
 025A 7F                ret
 025B                   .dbend
 025B                   .dbfunc e TurnLeft _TurnLeft fV
 025B           ;          pulse -> X-5
 025B           _TurnLeft::
 025B                   .dbline -1
 025B 10                push X
 025C 4F                mov X,SP
 025D 3802              add SP,2
 025F                   .dbline 59
 025F           ; }
 025F           ; 
 025F           ; //Kääntyy vasemmalle
 025F           ; void TurnLeft(int pulse)
 025F           ; {
 025F                   .dbline 60
 025F           ;       LEFTC_Data_ADDR &= NOLLAA;
 025F 4104F0            and REG[0x4],-16
 0262                   .dbline 60
 0262                   .dbline 61
 0262           ;       LEFTC_Data_ADDR |= LEFTFRIGHTB
 0262 430406            or REG[0x4],6
 0265                   .dbline 63
 0265           ;               
 0265           ;       PWM8_VASEN_WritePulseWidth((BYTE)(pulse * OIKEUSKERROIN));
 0265 550000            mov [__r1],<_OIKEUSKERROIN
 0268 5000              mov A,>_OIKEUSKERROIN
 026A 10                push X
 026B 5800              mov X,[__r1]
 026D 08                push A
 026E 28                romx
 026F 5300              mov [__r0],A
 0271 18                pop A
 0272 75                inc X
 0273 0900              adc A,0
 0275 08                push A
 0276 28                romx
 0277 5300              mov [__r1],A
 0279 18                pop A
 027A 75                inc X
 027B 0900              adc A,0
 027D 08                push A
 027E 28                romx
 027F 5300              mov [__r2],A
 0281 18                pop A
 0282 75                inc X
 0283 0900              adc A,0
 0285 28                romx
 0286 5300              mov [__r3],A
 0288 20                pop X
 0289 52FC              mov A,[X-4]
 028B 5300              mov [__r7],A
 028D 52FB              mov A,[X-5]
 028F 5300              mov [__r6],A
 0291 470080            tst [__r6],-128
 0294 A009              jz X6
 0296 5500FF            mov [__r5],-1
 0299 5500FF            mov [__r4],-1
 029C 8007              jmp X7
 029E           X6:
 029E 550000            mov [__r5],0
 02A1 550000            mov [__r4],0
 02A4           X7:
 02A4 5100              mov A,[__r4]
 02A6 08                push A
 02A7 5100              mov A,[__r5]
 02A9 08                push A
 02AA 5100              mov A,[__r6]
 02AC 08                push A
 02AD 5100              mov A,[__r7]
 02AF 08                push A
 02B0 7C0000            xcall __long2fp
 02B3 18                pop A
 02B4 5300              mov [__r7],A
 02B6 18                pop A
 02B7 5300              mov [__r6],A
 02B9 18                pop A
 02BA 5300              mov [__r5],A
 02BC 18                pop A
 02BD 5300              mov [__r4],A
 02BF 5100              mov A,[__r0]
 02C1 08                push A
 02C2 5100              mov A,[__r1]
 02C4 08                push A
 02C5 5100              mov A,[__r2]
 02C7 08                push A
 02C8 5100              mov A,[__r3]
 02CA 08                push A
 02CB 5100              mov A,[__r4]
 02CD 08                push A
 02CE 5100              mov A,[__r5]
 02D0 08                push A
 02D1 5100              mov A,[__r6]
 02D3 08                push A
 02D4 5100              mov A,[__r7]
 02D6 08                push A
 02D7 7C0000            xcall __fpmul
 02DA 18                pop A
 02DB 5300              mov [__r3],A
 02DD 18                pop A
 02DE 5300              mov [__r2],A
 02E0 18                pop A
 02E1 5300              mov [__r1],A
 02E3 18                pop A
 02E4 5300              mov [__r0],A
 02E6 38FC              add SP,-4
 02E8 5047              mov A,71
 02EA 08                push A
 02EB 5000              mov A,0
 02ED 08                push A
 02EE 08                push A
 02EF 08                push A
 02F0 5100              mov A,[__r0]
 02F2 08                push A
 02F3 5100              mov A,[__r1]
 02F5 08                push A
 02F6 5100              mov A,[__r2]
 02F8 08                push A
 02F9 5100              mov A,[__r3]
 02FB 08                push A
 02FC 7C0000            xcall __fpcmp
 02FF 38F8              add SP,-8
 0301 39FF              cmp A,-1
 0303 A047              jz L13
 0305 5047              mov A,71
 0307 08                push A
 0308 5000              mov A,0
 030A 08                push A
 030B 08                push A
 030C 08                push A
 030D 5100              mov A,[__r0]
 030F 08                push A
 0310 5100              mov A,[__r1]
 0312 08                push A
 0313 5100              mov A,[__r2]
 0315 08                push A
 0316 5100              mov A,[__r3]
 0318 08                push A
 0319 7C0000            xcall __fpsub
 031C 18                pop A
 031D 5300              mov [__r7],A
 031F 18                pop A
 0320 5300              mov [__r6],A
 0322 18                pop A
 0323 5300              mov [__r5],A
 0325 18                pop A
 0326 38FC              add SP,-4
 0328 08                push A
 0329 5100              mov A,[__r5]
 032B 08                push A
 032C 5100              mov A,[__r6]
 032E 08                push A
 032F 5100              mov A,[__r7]
 0331 08                push A
 0332 7C0000            xcall __fp2long
 0335 18                pop A
 0336 5300              mov [__r5],A
 0338 18                pop A
 0339 5300              mov [__r4],A
 033B 38FE              add SP,-2
 033D 5100              mov A,[__r5]
 033F 0100              add A,0
 0341 5401              mov [X+1],A
 0343 5100              mov A,[__r4]
 0345 0980              adc A,-128
 0347 5400              mov [X+0],A
 0349 8020              xjmp L14
 034B           L13:
 034B 5100              mov A,[__r0]
 034D 08                push A
 034E 5100              mov A,[__r1]
 0350 08                push A
 0351 5100              mov A,[__r2]
 0353 08                push A
 0354 5100              mov A,[__r3]
 0356 08                push A
 0357 7C0000            xcall __fp2long
 035A 18                pop A
 035B 5300              mov [__r1],A
 035D 18                pop A
 035E 5300              mov [__r0],A
 0360 38FE              add SP,-2
 0362 5100              mov A,[__r1]
 0364 5401              mov [X+1],A
 0366 5100              mov A,[__r0]
 0368 5400              mov [X+0],A
 036A           L14:
 036A 5201              mov A,[X+1]
 036C 10                push X
 036D 7C0000            xcall _PWM8_VASEN_WritePulseWidth
 0370 20                pop X
 0371                   .dbline 64
 0371           ;       PWM8_OIKEA_WritePulseWidth((BYTE)pulse);
 0371 52FC              mov A,[X-4]
 0373 10                push X
 0374 7C0000            xcall _PWM8_OIKEA_WritePulseWidth
 0377 20                pop X
 0378                   .dbline -2
 0378           L11:
 0378 38FE              add SP,-2
 037A 20                pop X
 037B                   .dbline 0 ; func end
 037B 7F                ret
 037C                   .dbsym l pulse -5 I
 037C                   .dbend
 037C                   .dbfunc e TurnRight _TurnRight fV
 037C           ;          pulse -> X-5
 037C           _TurnRight::
 037C                   .dbline -1
 037C 10                push X
 037D 4F                mov X,SP
 037E 3802              add SP,2
 0380                   .dbline 69
 0380           ; }
 0380           ; 
 0380           ; //Kääntyy oikealle
 0380           ; void TurnRight(int pulse)
 0380           ; {             
 0380                   .dbline 70
 0380           ;       LEFTC_Data_ADDR &= NOLLAA;
 0380 4104F0            and REG[0x4],-16
 0383                   .dbline 70
 0383                   .dbline 71
 0383           ;       LEFTC_Data_ADDR |= LEFTBRIGHTF;
 0383 430409            or REG[0x4],9
 0386                   .dbline 71
 0386                   .dbline 73
 0386           ;       
 0386           ;       PWM8_VASEN_WritePulseWidth((BYTE)(pulse * OIKEUSKERROIN));
 0386 550000            mov [__r1],<_OIKEUSKERROIN
 0389 5000              mov A,>_OIKEUSKERROIN
 038B 10                push X
 038C 5800              mov X,[__r1]
 038E 08                push A
 038F 28                romx
 0390 5300              mov [__r0],A
 0392 18                pop A
 0393 75                inc X
 0394 0900              adc A,0
 0396 08                push A
 0397 28                romx
 0398 5300              mov [__r1],A
 039A 18                pop A
 039B 75                inc X
 039C 0900              adc A,0
 039E 08                push A
 039F 28                romx
 03A0 5300              mov [__r2],A
 03A2 18                pop A
 03A3 75                inc X
 03A4 0900              adc A,0
 03A6 28                romx
 03A7 5300              mov [__r3],A
 03A9 20                pop X
 03AA 52FC              mov A,[X-4]
 03AC 5300              mov [__r7],A
 03AE 52FB              mov A,[X-5]
 03B0 5300              mov [__r6],A
 03B2 470080            tst [__r6],-128
 03B5 A009              jz X9
 03B7 5500FF            mov [__r5],-1
 03BA 5500FF            mov [__r4],-1
 03BD 8007              jmp X10
 03BF           X9:
 03BF 550000            mov [__r5],0
 03C2 550000            mov [__r4],0
 03C5           X10:
 03C5 5100              mov A,[__r4]
 03C7 08                push A
 03C8 5100              mov A,[__r5]
 03CA 08                push A
 03CB 5100              mov A,[__r6]
 03CD 08                push A
 03CE 5100              mov A,[__r7]
 03D0 08                push A
 03D1 7C0000            xcall __long2fp
 03D4 18                pop A
 03D5 5300              mov [__r7],A
 03D7 18                pop A
 03D8 5300              mov [__r6],A
 03DA 18                pop A
 03DB 5300              mov [__r5],A
 03DD 18                pop A
 03DE 5300              mov [__r4],A
 03E0 5100              mov A,[__r0]
 03E2 08                push A
 03E3 5100              mov A,[__r1]
 03E5 08                push A
 03E6 5100              mov A,[__r2]
 03E8 08                push A
 03E9 5100              mov A,[__r3]
 03EB 08                push A
 03EC 5100              mov A,[__r4]
 03EE 08                push A
 03EF 5100              mov A,[__r5]
 03F1 08                push A
 03F2 5100              mov A,[__r6]
 03F4 08                push A
 03F5 5100              mov A,[__r7]
 03F7 08                push A
 03F8 7C0000            xcall __fpmul
 03FB 18                pop A
 03FC 5300              mov [__r3],A
 03FE 18                pop A
 03FF 5300              mov [__r2],A
 0401 18                pop A
 0402 5300              mov [__r1],A
 0404 18                pop A
 0405 5300              mov [__r0],A
 0407 38FC              add SP,-4
 0409 5047              mov A,71
 040B 08                push A
 040C 5000              mov A,0
 040E 08                push A
 040F 08                push A
 0410 08                push A
 0411 5100              mov A,[__r0]
 0413 08                push A
 0414 5100              mov A,[__r1]
 0416 08                push A
 0417 5100              mov A,[__r2]
 0419 08                push A
 041A 5100              mov A,[__r3]
 041C 08                push A
 041D 7C0000            xcall __fpcmp
 0420 38F8              add SP,-8
 0422 39FF              cmp A,-1
 0424 A047              jz L17
 0426 5047              mov A,71
 0428 08                push A
 0429 5000              mov A,0
 042B 08                push A
 042C 08                push A
 042D 08                push A
 042E 5100              mov A,[__r0]
 0430 08                push A
 0431 5100              mov A,[__r1]
 0433 08                push A
 0434 5100              mov A,[__r2]
 0436 08                push A
 0437 5100              mov A,[__r3]
 0439 08                push A
 043A 7C0000            xcall __fpsub
 043D 18                pop A
 043E 5300              mov [__r7],A
 0440 18                pop A
 0441 5300              mov [__r6],A
 0443 18                pop A
 0444 5300              mov [__r5],A
 0446 18                pop A
 0447 38FC              add SP,-4
 0449 08                push A
 044A 5100              mov A,[__r5]
 044C 08                push A
 044D 5100              mov A,[__r6]
 044F 08                push A
 0450 5100              mov A,[__r7]
 0452 08                push A
 0453 7C0000            xcall __fp2long
 0456 18                pop A
 0457 5300              mov [__r5],A
 0459 18                pop A
 045A 5300              mov [__r4],A
 045C 38FE              add SP,-2
 045E 5100              mov A,[__r5]
 0460 0100              add A,0
 0462 5401              mov [X+1],A
 0464 5100              mov A,[__r4]
 0466 0980              adc A,-128
 0468 5400              mov [X+0],A
 046A 8020              xjmp L18
 046C           L17:
 046C 5100              mov A,[__r0]
 046E 08                push A
 046F 5100              mov A,[__r1]
 0471 08                push A
 0472 5100              mov A,[__r2]
 0474 08                push A
 0475 5100              mov A,[__r3]
 0477 08                push A
 0478 7C0000            xcall __fp2long
 047B 18                pop A
 047C 5300              mov [__r1],A
 047E 18                pop A
 047F 5300              mov [__r0],A
 0481 38FE              add SP,-2
 0483 5100              mov A,[__r1]
 0485 5401              mov [X+1],A
 0487 5100              mov A,[__r0]
 0489 5400              mov [X+0],A
 048B           L18:
 048B 5201              mov A,[X+1]
 048D 10                push X
 048E 7C0000            xcall _PWM8_VASEN_WritePulseWidth
 0491 20                pop X
 0492                   .dbline 74
 0492           ;       PWM8_OIKEA_WritePulseWidth((BYTE)pulse);
 0492 52FC              mov A,[X-4]
 0494 10                push X
 0495 7C0000            xcall _PWM8_OIKEA_WritePulseWidth
 0498 20                pop X
 0499                   .dbline -2
 0499           L15:
 0499 38FE              add SP,-2
 049B 20                pop X
 049C                   .dbline 0 ; func end
 049C 7F                ret
 049D                   .dbsym l pulse -5 I
 049D                   .dbend
 049D                   .dbfunc e TestTurnLeft _TestTurnLeft fV
 049D           ;          pulse -> X-5
 049D           _TestTurnLeft::
 049D                   .dbline -1
 049D 10                push X
 049E 4F                mov X,SP
 049F                   .dbline 80
 049F           ; }
 049F           ; 
 049F           ; 
 049F           ; //TEST LEFTTURN
 049F           ; void TestTurnLeft(int pulse)
 049F           ; {
 049F                   .dbline 81
 049F           ;       LEFTC_Data_ADDR &= NOLLAA;
 049F 4104F0            and REG[0x4],-16
 04A2                   .dbline 81
 04A2                   .dbline 82
 04A2           ;       LEFTC_Data_ADDR |= 0b00000001;
 04A2 430401            or REG[0x4],1
 04A5                   .dbline 84
 04A5           ;       
 04A5           ;       PWM8_VASEN_WritePulseWidth(0);
 04A5 10                push X
 04A6 5000              mov A,0
 04A8 7C0000            xcall _PWM8_VASEN_WritePulseWidth
 04AB 20                pop X
 04AC                   .dbline 85
 04AC           ;       PWM8_OIKEA_WritePulseWidth((BYTE)pulse);
 04AC 52FC              mov A,[X-4]
 04AE 10                push X
 04AF 7C0000            xcall _PWM8_OIKEA_WritePulseWidth
 04B2 20                pop X
 04B3                   .dbline -2
 04B3           L19:
 04B3 20                pop X
 04B4                   .dbline 0 ; func end
 04B4 7F                ret
 04B5                   .dbsym l pulse -5 I
 04B5                   .dbend
